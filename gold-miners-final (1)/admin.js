import { useEffect, useState } from 'react'
export default function Admin({ showToast }){ const [password, setPassword] = useState(''); const [deposits, setDeposits] = useState([]); const [loading, setLoading] = useState(false); useEffect(()=>{ fetchDeposits() },[]); const fetchDeposits = async ()=>{ const r = await fetch('/api/deposits'); const data = await r.json(); setDeposits(data); } const perform = async (id, action)=>{ setLoading(true); const r = await fetch('/api/deposits/approve', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ id, action, password }) }); if(r.ok){ const updated = await r.json(); showToast(`Deposit ${action}d: R${updated.amount}`); fetchDeposits(); } else { const err = await r.json(); showToast(err.error || 'Action failed'); } setLoading(false); } const isAuth = password === (process.env.NEXT_PUBLIC_ADMIN_PASS || 'PK.'); return (<div><h2 className="text-2xl font-bold mb-4">Admin</h2><div className="bg-white p-4 rounded shadow mb-4"><label>Admin password</label><input value={password} onChange={e=>setPassword(e.target.value)} className="w-full p-2 border rounded mb-3" /><p className="text-sm">(Enter admin password to manage deposits)</p></div>{isAuth ? (<div className="space-y-3">{deposits.length===0 && <div className="p-3 bg-amber-50 rounded">No pending deposits</div>}{deposits.map(p => (<div key={p.id} className="bg-white p-4 rounded shadow flex justify-between items-center"><div><div className="font-bold">Deposit</div><div>Amount: R{p.amount.toLocaleString()}</div><div>TS: {p.ts}</div></div><div className="flex gap-2"><button disabled={loading} onClick={()=>perform(p.id,'approve')} className="px-3 py-1 bg-green-500 text-white rounded">Approve</button><button disabled={loading} onClick={()=>perform(p.id,'reject')} className="px-3 py-1 bg-red-500 text-white rounded">Reject</button></div></div>))}</div>) : (<div className="p-4 bg-yellow-50 rounded">Enter admin password to view pending deposits.</div>)}</div>) }
